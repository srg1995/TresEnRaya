window.onload=iniciarJuego();

turno=0
TAM_TABLA=3;
nPulsadas=0;

tabla=new Array(TAM_TABLA);
for(var i=0;i<TAM_TABLA;i++){
    tabla[i]=new Array(TAM_TABLA);
}

for(var i=0;i<TAM_TABLA;i++){
    for(var j=0;j<TAM_TABLA;j++){
        tabla[i][j]=3;
    }
}

function iniciarJuego(){
    pintarTablero();    
}

function pintarTablero(){
    var capa = document.getElementById("tablero");

    /*Crea un elemento <table> y un elemento <tbody>*/
    var tabla   = document.createElement("table");
    var tblBody = document.createElement("tbody");

    /*recorro las filas para crear los tr*/
    for (var f = 0; f < 3; f++) {

        /* Crea los tr de la tabla*/
        var fil = document.createElement("tr");
        /* recorro las columnas para crear los td*/
        for (var c = 0; c < 3; c++) {

            /* Crea los td de la tabla*/
            var col = document.createElement("td");
            //doy estilo a la casilla
            col.style.background="white";
            
            col.id=f+"#"+c;
            
            
            //le agrego un escuchador de raton
            col.addEventListener("mousedown",pulsarCasilla,false);
            
            //inserto en fil col
            fil.appendChild(col);
        }
        //inserto en tblBody fil
        tblBody.appendChild(fil);
    }
    //inserto rn tabla tblbody
    tabla.appendChild(tblBody);
    
    //inserto en el article la tabla
    capa.appendChild(tabla);
    
    /* modifica el atributo "border" de la tabla y lo fija a "1";*/
    tabla.setAttribute("border", "1");
}

function pulsarCasilla(){
    //elimino el escuchador de esa casilla para que no se vulva a interactuar con ella
    this.removeEventListener("mousedown",pulsarCasilla,false);
    nPulsadas++;
    
    if(turno==0){
        this.style.backgroundImage="url('./imagenes/circulo.png')";
        this.style.backgroundRepeat="no-repeat";
    }
    else if(turno==1){
        this.style.backgroundImage="url('./imagenes/cruz.png')";
        this.style.backgroundRepeat="no-repeat";
    }
    
    posiciones=this.id;
    posicion=posiciones.split("#");
    tabla[posicion[0]][posicion[1]]=turno;
    
    if(!comprobar() && nPulsadas<9){
        cambiarTurno();
    }
    else{
        if(nPulsadas>8 && !comprobar()){
            document.getElementById("tablero").innerHTML="EMPATE";
        }
        else{
            document.getElementById("tablero").innerHTML="HA GANADO JUGADOR "+(turno+1);
        }
        
    }
}

function cambiarTurno(){
    turno=(turno+1)%2;
}

function comprobar(){
    for(var i=0;i<TAM_TABLA;i++){
        if(tabla[i][0]==tabla[i][1] && tabla[i][1]==tabla[i][2] && tabla[i][0]!=3 ||
                tabla[0][i]==tabla[1][i] && tabla[0][i]==tabla[2][i] && tabla[0][i]!=3){
            return true;
        }
    }   
    if(tabla[0][0]==tabla[1][1] && tabla[0][0]==tabla[2][2] && tabla[0][0]!=3 || 
            tabla[0][2]==tabla[1][1] && tabla[0][2]==tabla[2][0] && tabla[0][2]!=3){
        return true;
    }
    return false;
}